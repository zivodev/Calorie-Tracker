<head>
  <title>
    CalorieScope
  </title>
</head>




<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>CalorieScope Form — Mobile Friendly</title>
<style>
  /* ✅ Full-viewport layout */
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #111; /* matches your app color */
    color: #fff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .form-wrap {
    width: 100%;
    max-width: 400px;
    padding: 20px;
    box-sizing: border-box;
  }

  form#userForm {
    display: flex;
    flex-direction: column;
    gap: 14px;
    width: 100%;
  }

  input, select, button {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    box-sizing: border-box;
  }

  input, select {
    background: #222;
    color: #fff;
  }

  button {
    background: #d3a15d;
    color: #111;
    font-weight: 600;
    cursor: pointer;
  }

  #goal, #progressContainer {
    text-align: center;
    margin-top: 20px;
  }

  progress {
    width: 100%;
    height: 18px;
  }

  @media (max-width: 480px) {
    html, body {
      align-items: center;
    }
    .form-wrap {
      padding: 14px;
      max-width: 100%;
    }
    input, select, button {
      font-size: 18px;
    }
  }
</style>
</head>
<body>
  <div class="form-wrap">
    <form id="userForm" novalidate>
      <input type="number" id="age" placeholder="Age" required />
      <input type="number" id="weight" placeholder="Weight (kg)" required />
      <input type="number" id="height" placeholder="Height (cm)" required />

      <select id="gender" required>
        <option value="">Select Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>

      <select id="activity" required>
        <option value="">Activity Level</option>
        <option value="sedentary">Sedentary (little or no exercise)</option>
        <option value="light">Lightly Active (1–3 days/week)</option>
        <option value="moderate">Moderately Active (3–5 days/week)</option>
        <option value="active">Active (6–7 days/week)</option>
        <option value="very_active">Very Active (hard daily exercise)</option>
      </select>

      <button type="submit">Get Calorie Goal</button>
    </form>

    <div id="goal"></div>

    <div id="progressContainer" style="display:none;">
      <progress id="calorieBar" value="0" max="100"></progress>
      <p id="progressText">0 / 0 kcal</p>
      <input type="file" id="mealImage" accept="image/*" />
      <button id="sendImage">Send Image</button>
    </div>
  </div>

<script>
let goal = 0;
let current = 0;

document.getElementById('userForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const data = {
    age: document.getElementById('age').value,
    weight: document.getElementById('weight').value,
    height: document.getElementById('height').value,
    gender: document.getElementById('gender').value,
    activity: document.getElementById('activity').value
  };

  try {
    const res = await fetch('https://zivodev.app.n8n.cloud/webhook/bcddd092-eaa8-4a52-9e24-a1a7e5b26dd6', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const text = await res.text();
    let result;
    try { result = JSON.parse(text); } catch { result = {}; }

    goal = Number(result.dailyGoal) || 0;
    document.getElementById('goal').textContent = `Your daily goal: ${goal} kcal`;
    document.getElementById('progressContainer').style.display = 'block';
    document.getElementById('calorieBar').max = Math.max(goal, 1);
    document.getElementById('progressText').textContent = `${current} / ${goal} kcal`;

  } catch (err) {
    console.error("Fetch error:", err);
    alert('Error fetching goal.');
  }
});

document.getElementById('sendImage').addEventListener('click', async () => {
  const file = document.getElementById('mealImage').files[0];
  if (!file) return alert('Upload an image first');

  const formData = new FormData();
  formData.append('image', file);
  formData.append('goal', goal);
  formData.append('current', current);

  const res = await fetch('https://YOUR-N8N-URL/webhook/meal-image', {
    method: 'POST',
    body: formData
  });

  const result = await res.json();
  const calories = Number(result.mealCalories) || 0;
  current += calories;

  document.getElementById('calorieBar').value = current;
  document.getElementById('progressText').textContent = `${current} / ${goal} kcal`;
});
</script>
</body>
</html>
