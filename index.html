<form id="userForm">
  <input type="number" id="age" placeholder="Age" required>
  <input type="number" id="weight" placeholder="Weight (kg)" required>
  <input type="number" id="height" placeholder="Height (cm)" required>

  <!-- ✅ Added gender and activity fields -->
  <select id="gender" required>
    <option value="">Select Gender</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
  </select>

  <select id="activity" required>
    <option value="">Activity Level</option>
    <option value="sedentary">Sedentary (little or no exercise)</option>
    <option value="light">Lightly Active (1–3 days/week)</option>
    <option value="moderate">Moderately Active (3–5 days/week)</option>
    <option value="active">Active (6–7 days/week)</option>
    <option value="very_active">Very Active (hard daily exercise)</option>
  </select>

  <button type="submit">Get Calorie Goal</button>
</form>

<div id="goal" style="margin-top:20px;"></div>
<div id="progressContainer" style="display:none;">
  <progress id="calorieBar" value="0" max="100"></progress>
  <p id="progressText">0 / 0 kcal</p>
  <input type="file" id="mealImage" accept="image/*">
  <button id="sendImage">Send Image</button>
</div>

<script>
let goal = 0;
let current = 0;

document.getElementById('userForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const data = {
    age: document.getElementById('age').value,
    weight: document.getElementById('weight').value,
    height: document.getElementById('height').value,
    gender: document.getElementById('gender').value,     // ✅ Added
    activity: document.getElementById('activity').value  // ✅ Added
  };

  const res = await fetch('https://zivodev.app.n8n.cloud/webhook-test/bcddd092-eaa8-4a52-9e24-a1a7e5b26dd6', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  const result = await res.json();
  goal = result.dailyGoal;
  document.getElementById('goal').textContent = `Your daily goal: ${goal} kcal`;
  document.getElementById('progressContainer').style.display = 'block';
  document.getElementById('calorieBar').max = goal;
});

document.getElementById('sendImage').addEventListener('click', async () => {
  const file = document.getElementById('mealImage').files[0];
  if (!file) return alert('Upload an image first');

  const formData = new FormData();
  formData.append('image', file);
  formData.append('goal', goal);
  formData.append('current', current);

  const res = await fetch('https://YOUR-N8N-URL/webhook/meal-image', {
    method: 'POST',
    body: formData
  });

  const result = await res.json();
  const calories = result.mealCalories;
  current += calories;

  document.getElementById('calorieBar').value = current;
  document.getElementById('progressText').textContent = `${current} / ${goal} kcal`;
});
</script>
